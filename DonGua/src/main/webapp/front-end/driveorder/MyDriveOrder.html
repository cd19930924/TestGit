<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta name="description" content="" />
<meta name="author" content="" />
<title>Daily Warmæˆ‘çš„æ´¾è»Šè¨‚å–®</title>
<!-- Favicon-->
<link rel="icon" type="image/x-icon" href="../assets/healthcare.png" />
<link href="https://fonts.googleapis.com/earlyaccess/cwtexyen.css" rel="stylesheet">
<!-- Bootstrap Icons-->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
	rel="stylesheet" />
<link
	href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.min.css"
	rel="stylesheet" />
<!-- Font Awesome icons (free version)-->
<script src="https://use.fontawesome.com/releases/v5.15.4/js/all.js"
	crossorigin="anonymous"></script>
<script src="http://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://kit.fontawesome.com/19fb92fb24.js" crossorigin="anonymous"></script>
<!-- Google fonts-->
<link
	href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700"
	rel="stylesheet" />
<link
	href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic"
	rel="stylesheet" type="text/css" />
<!-- SimpleLightbox plugin CSS-->
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.css"
	rel="stylesheet" />
<!-- Core theme CSS (includes Bootstrap)-->
<link href="../css/styles.css" rel="stylesheet" />
<style>
	.mybtn{
		width:100%;
		background-color:#fae1a7
	}

	i{
		color:#9e5b20
	}
	th{
		color:#9e5b20;
		background:#f5e7ba;
		border:1px solid white;
	}
	td{
		background:#f7efd2;
		border:1px solid white;
	}
	.card-header{
		background-color:#f5e7ba
	}
	.card-body{
		background-color:#f7efd2
	}
	.swal-wide{
		width:80% !important;
	}
	body,button, input,select, textarea,h1 ,h2, h3, h4, h5, h6 {
  		font-family:cwtexyen, Merriweather;
	}
</style>


</head>

<body id="page-top">
	<!-- Navigation å°è¦½åˆ— -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav">
        <div class="container px-4 px-lg-0">
            <a class="navbar-brand" href="../afterlogin.jsp">Daily Warm</a>
            <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
                aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto my-2 my-lg-0">
                 <!-- é¦–é  -->
                    <li class="nav-item"><a class="nav-link" href="../afterlogin.jsp">é¦–é </a></li>
                    <!-- é—œæ–¼æˆ‘å€‘ -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            é—œæ–¼æˆ‘å€‘
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="../news/newspage.jsp">æœ€æ–°æ¶ˆæ¯</a></li>
                            <li><a class="dropdown-item" href="../info/serviceIntro.jsp">ç¶²ç«™ç°¡ä»‹</a></li>
                            <li><a class="dropdown-item" href="../info/faq.jsp">å¸¸è¦‹å•é¡Œ</a></li>
                        </ul>
                    </li>
                    <!-- æ­·å²è¨‚å–® -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            æ­·å²è¨‚å–®
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="../careRequest/requestMgt.jsp">ç…§è­·</a></li>
                            <li><a class="dropdown-item" href="../meal/memorder.jsp">é¤é»</a></li>
                            <li><a class="dropdown-item" href="../driveorder/MyDriveOrder.html">æ´¾è»Š</a></li>
                        </ul>
                    </li>
                    <!-- é€šçŸ¥ -->
                    <li class="nav-item"><a class="nav-link" href="../mailbox/noticeCenter.jsp">é€šçŸ¥</a></li>
                    <!-- æœƒå“¡ -->
                    <li class="nav-item dropdown">
                        <a class="nav-link" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <i class="fas fa-user-circle fa-2x "></i>
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                          <li><a class="dropdown-item" id="switchAcct"href="../Carer.jsp">åˆ‡æ›å¸³è™Ÿ</a></li>
                            <li><a class="dropdown-item" id="applyCarer" href="../carermemapply/CarerMemApplyPage.jsp">ç”³è«‹æˆç‚ºç…§è­·å“¡</a></li>
                            <li><a class="dropdown-item" id="memberData" href="../member/setMemData.html">æœƒå“¡è³‡æ–™è¨­å®š</a></li>
                            <li><a class="dropdown-item" id="logout">ç™»å‡º</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
	<!-- Masthead ABOUT US -->
	<!-- Services æœå‹™å…§å®¹ -->
	<section class="page-section" id="portfolio" style="margin-top: 50px;background-color:#f1d683">
		<div class="container-fluid">

			<!-- Page Heading -->
			<h1 class="h3 mb-2 text-gray-800">æˆ‘çš„æ´¾è»Šè¨‚å–®</h1>
			<!-- DataTales Example -->
			<div class="card shadow mb-4">
				<div class="card-header py-3"
					style="justify-content: space-between; display: flex">
					<select style="border-radius: 0.35rem" id="selectStatus">
						<option value="7">æ‰€æœ‰è¨‚å–®</option>
						<option value="0">å¾…åŸ·è¡Œ</option>
						<option value="1">åŸ·è¡Œä¸­</option>
						<option value="2">å·²å®Œæˆ</option>
						<option value="3">å·²çµå–®</option>
						<option value="4">å–æ¶ˆç”³è«‹ä¸­</option>
						<option value="5">å·²å–æ¶ˆ</option>
					</select> <input type=date id="searchDate">
				</div>
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-bordered" id="dataTable" width="100%"
							cellspacing="0" style="text-align:center">
							<thead>
								<tr>
									<th><i class="fa-solid fa-list-ol"></i> è¨‚å–®ID</th>
									<th><i class="fa-solid fa-calendar-check"></i> æ¥é€æ—¥æœŸ</th>
									<th><i class="fa-solid fa-clock"></i> æ¥é€æ™‚é–“</th>
									<th><i class="fa-solid fa-comment-dollar"></i> è¨‚å–®é‡‘é¡</th>
									<th><i class="fa-solid fa-circle-info"></i> è¨‚å–®ç‹€æ…‹</th>
									<th><i class="fa-solid fa-comment"></i> å‚™è¨»</th>
									<th><i class="fa-solid fa-rectangle-xmark"></i> å–æ¶ˆ</th>
									<th><i class="fa-solid fa-clipboard-list"></i> æ˜ç´°</th>
								</tr>
							</thead>
							<tfoot>
								<tr>
									<th><i class="fa-solid fa-list-ol"></i> è¨‚å–®ID</th>
									<th><i class="fa-solid fa-calendar-check"></i> æ¥é€æ—¥æœŸ</th>
									<th><i class="fa-solid fa-clock"></i> æ¥é€æ™‚é–“</th>
									<th><i class="fa-solid fa-comment-dollar"></i> è¨‚å–®é‡‘é¡</th>
									<th><i class="fa-solid fa-circle-info"></i> è¨‚å–®ç‹€æ…‹</th>
									<th><i class="fa-solid fa-comment"></i> å‚™è¨»</th>
									<th><i class="fa-solid fa-rectangle-xmark"></i> å–æ¶ˆ</th>
									<th><i class="fa-solid fa-clipboard-list"></i> æ˜ç´°</th>
								</tr>
							</tfoot>
							<tbody>
							</tbody>
						</table>
					<div id="orderInfo"></div>
				</div>
			</div>
		</div>
	</section>

	<!-- Footer -->
	<footer class="bg-light py-5">
		<div class="container px-4 px-lg-5">
			<div class="small text-center text-muted">Copyright &copy; 2021
				- Daily Warm</div>
		</div>
	</footer>
	<!-- Bootstrap core JS-->
	<!-- SimpleLightbox plugin JS-->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.js"></script>
	<!-- Core theme JS-->
	<script src="http://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@latest"></script>
	 <script src="../js/utility.js"></script>
    <script src="../js/afterLogin.js"></script>
    
	
	<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
	<!-- * *                               SB Forms JS                               * *-->
	<!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
	<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
	<!-- <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script> -->
</body>

<script>

//è¼‰å…¥å®Œæˆè®€å–æ­¤æœƒå“¡æ‰€æœ‰æ´¾è»Šè¨‚å–®
$(document).ready(function () {
	$.ajax({
        url: "driveorder.do", /*GETæ ¼å¼*/
        type: "POST",
        data:{
        	action:"Get_Order_Member",
        },
        success: function (data) {
            getData(data);
        }
    });
});


//é€éè¨‚å–®ç‹€æ…‹æœå°‹æ­¤æœƒå“¡çš„æ´¾è»Šè¨‚å–®
$("#selectStatus").change(function () {
	$("#searchDate").val("");
    $.ajax({
        url: "driveorder.do",
        type: "POST",
        data:{
        	action:"Get_Order_Member_Status",
        	orderStatus:$("#selectStatus").val(),
        },
        success: function (data) {
            getData(data);
        }
    });
});

//é€éæ´¾è»Šæ—¥æœŸæœå°‹æ­¤æœƒå“¡çš„æ´¾è»Šè¨‚å–®
$("#searchDate").change(function () {
	$("#selectStatus").val("7");
    $.ajax({
        url: "driveorder.do", /*GETæ ¼å¼*/
        type: "POST",
        data:{
        	action:"Get_Order_Member_Date",
        	sendDriveDate:$("#searchDate").val(),
        },
        success: function (data) {
            getData(data);
        }
    });
});

//è®€å–è³‡æ–™ä¸¦é¡¯ç¤ºåœ¨ç•«é¢ä¸Š
function getData(data) {
	if($.fn.DataTable.isDataTable("#dataTable")){
		 $('#dataTable').dataTable().fnClearTable();
		 $('#dataTable').dataTable().fnDestroy();
	}
	$("tbody").html('');
    var jsonObj = JSON.parse(data);
    for (let option of jsonObj) {
    	let se = (option.sendDriveDate).substring(0,10);
    	let st = (option.sendDriveTime).substring(9,11)+" "+(option.sendDriveTime).substring(0,8);
    	$("tbody").append(`<tr>
    			<td id="od${option.drverOrderId}" style="vertical-align:middle">${option.drverOrderId}</td>
                <td id="md${option.drverOrderId}">${se}</td>
                <td id="dd${option.drverOrderId}">${st}</td>
                <td id="se${option.drverOrderId}">${option.orderAmount}</td>
                <td id="os${option.drverOrderId}">
                ${option.orderStatus=="0"?"å¾…åŸ·è¡Œ":""}
                ${option.orderStatus=="1"?"åŸ·è¡Œä¸­":""}
                ${option.orderStatus=="2"?"å·²å®Œæˆ":""}
                ${option.orderStatus=="3"?"å·²çµå–®":""}
                ${option.orderStatus=="4"?"å–æ¶ˆç”³è«‹ä¸­":""}
                ${option.orderStatus=="5"?"å·²å–æ¶ˆ":""}
                </td>
                <td id="ue${option.drverOrderId}" ondblclick="hi(this)"></td>
                <td><input type="button" class="mybtn" id="del${option.drverOrderId}" value="âŒ" style="border-radius: 0.35rem" onclick="delItem(this)"></td>
                <td><input type="button" class="mybtn" id="ser${option.drverOrderId}" value="ğŸ“ƒ" style="border-radius: 0.35rem" onclick="serItem(this)"></td>
                </tr>`);
         if(option.orderStatus !== "0"){
         	$("#del"+option.drverOrderId).remove();
         } 
         if(option.driveFeedback == null){
        	 $("#ue"+option.drverOrderId).html(`<input type="button" class="mybtn" id="fbk${option.drverOrderId}" value="æ–°å¢å‚™è¨»" style="border-radius: 0.35rem" onclick="myFbk(this)">`);
         }else{
        	 $("#ue"+option.drverOrderId).html(`<input type="button" class="mybtn" id="fbk${option.drverOrderId}" value="ä¿®æ”¹å‚™è¨»" style="border-radius: 0.35rem" onclick="myFbk(this)">`);
         }
    }
    $("#dataTable").DataTable({
        language: {
            url: '//cdn.datatables.net/plug-ins/1.11.4/i18n/zh_Hant.json'
        },
        pagingType: "full_numbers",
        ordering : false,
        retrieve: true,
    });
}


function delItem(item) {
		let drverOrderId = item.id.substring(3);
        	$.ajax({
                url: "driveorder.do", /*GETæ ¼å¼*/
                type: "POST",
                data:{
                	action:"CancelApply_Order_Id",
                	drverOrderId:drverOrderId,
                },
        	});
        	item.remove();
        	$("#os"+drverOrderId).text("å–æ¶ˆç”³è«‹ä¸­")
}

function serItem(item) {
	let drverOrderId = item.id.substring(3);
    $.ajax({
        url: "driveorder.do", /*GETæ ¼å¼*/
        type: "POST",
        data:{
        	action:"Get_Order_Info",
        	drverOrderId:drverOrderId,
        },
        success: function (data) {
            var jsonObj = JSON.parse(data);
            for (let option of jsonObj) {
            	let se = (option.sendDriveDate).substring(0,10);
            	let st = (option.sendDriveTime).substring(9,11)+" "+(option.sendDriveTime).substring(0,8);
            	Swal.fire({
            		title:"è¨‚å–®è©³ç´°è³‡è¨Š",
            		html:
            			`<table style="width:100%">`+
            			`<tr><th>è¨‚å–®ç·¨è™Ÿ</th><td>${option.drverOrderId}</td><th>é è¨ˆé‡Œç¨‹æ•¸</th><td>${option.distance}</td></tr>`+
            			`<tr><th>å¸æ©ŸID</th><td>${option.driverId}</td><th>è¨‚å–®é‡‘é¡</th><td>${option.orderAmount}</td></tr>`+
            			`<tr><th>å¸æ©Ÿå§“å</th><td>${option.driverName}</td><th>æ´¾è»Šæ—¥æœŸ</th><td>${se}</td></tr>`+
            			`<tr><th>å¸æ©Ÿæ‰‹æ©Ÿ</th><td>${option.driverPhone}</td><th>æ´¾è»Šæ™‚é–“</th><td>${st}</td></tr>`+
            			`<tr><th>å¸æ©Ÿè»Šç‰Œè™Ÿç¢¼</th><td>${option.carNumber}</td><th>è¯çµ¡äººå§“å</th><td>${option.contactName}</td></tr>`+
            			`<tr><th >å‡ºç™¼é»</th><td nowrap="nowrap">${option.startPoint}</td><th>è¯çµ¡é›»è©±</th><td>${option.contactNumber}</td></tr>`+
            			`<tr><th>ç›®çš„åœ°</th><td nowrap="nowrap">${option.endPoint}</td><th>è¨‚å–®ç‹€æ…‹</th><td>`+
            			`${option.orderStatus=="0"?"å¾…åŸ·è¡Œ":""}`+
                        `${option.orderStatus=="1"?"åŸ·è¡Œä¸­":""}`+
                        `${option.orderStatus=="2"?"å·²å®Œæˆ":""}`+
                        `${option.orderStatus=="3"?"å·²çµå–®":""}`+
                        `${option.orderStatus=="4"?"å–æ¶ˆç”³è«‹ä¸­":""}`+
                        `${option.orderStatus=="5"?"å·²å–æ¶ˆ":""}`+
            			`<tr><th>å‚™è¨»</th><td style="word-break:break-all" colspan="3">${option.driveFeedback==null?"å°šæœªå¡«å¯«":(option.driveFeedback)}</td></tr>`+
            			`</table>`,
            		background:"#f1d683",
            		customClass: 'swal-wide',
            	});
            }
        }
    });
}
function myFbk(item) {
	let drverOrderId = item.id.substring(3);
    $.ajax({
        url: "driveorder.do", /*GETæ ¼å¼*/
        type: "POST",
        data:{
        	action:"Get_Order_Feedback",
        	drverOrderId:drverOrderId,
        },
        success: function (data) {
        	$("#orderInfo").css({
        		"background-color": "white",
        		"border":"1px solid black",
        		"text-align":"center",
        		"width":"300px",
        		"height":"400px",
        		"z-index":"77",
        		"position":"fixed",
        		"top":"15%",
        		"left":"50%",
        		"margin-left":"-150px"
        	});
            var jsonObj = JSON.parse(data);
            for (let option of jsonObj) {
            	$("#orderInfo").html(`
        				<table width="100%" height="100%">
            			<thead bgcolor="#dedede"><tr><th>æˆ‘çš„è¨‚å–®å‚™è¨»</th></tr></thead>
            			<tbody height="80%"><tr>
            			<td id="fb${drverOrderId}" contenteditable="true" valign="top" align="left" style="word-break: break-all">
            			${option.driveFeedback == null? "": option.driveFeedback}
            			</td></tr></tbody>
            			<tfoot bgcolor="#dedede"><tr><th>
            			<input type="button" value="å–æ¶ˆ" onclick="clearInfo()">
            			<input type="button" value="ç¢ºå®š" onclick="edtFbk(${drverOrderId})">
            			</th></tr></tfoot>
            			</table>`);
            }
        }
    });
}

function edtFbk(drverOrderId){
	$.ajax({
        url: "driveorder.do",
        type: "POST",
        data:{
        	action:"Change_Order_Feedback",
        	drverOrderId:drverOrderId,
        	driveFeedback:$("#fb"+drverOrderId).text(),
        }
    });
	$("#orderInfo").html('');
	$("#orderInfo").removeAttr("style","");
}

function clearInfo(){
	$("#orderInfo").html(''); //innerHTML
	$("#orderInfo").removeAttr("style",""); //Attritue
}


function preventBack(){window.history.forward();}
setTimeout("preventBack()", 0);
window.onunload=function(){null};
</script>

</html>